# 生成AIを搭載したチャットアプリケーションの構築

[![生成AIを搭載したチャットアプリケーションの構築](../../images/07-lesson-banner.png?WT.mc_id=academic-105485-koreyst)](https://youtu.be/Kw4i-tlKMrQ?WT.mc_id=academic-105485-koreyst)

> このレッスンのビデオを見るには上の画像をクリックしてください。

テキスト生成アプリの作り方を見てきたところで、次はチャットアプリについて見ていこう。

チャットアプリケーションは私たちの日常生活に溶け込み、カジュアルな会話の手段以上のものを提供しています。チャットアプリケーションは、カスタマーサービス、テクニカルサポート、さらには高度なアドバイスシステムにおいて不可欠な要素となっています。少し前に、チャットアプリケーションから何らかの助けを得たことがあるかもしれません。生成AIのようなより高度なテクノロジーをこれらのプラットフォームに統合するにつれ、複雑さが増し、課題も増えている。

私たちが答えなければならないいくつかの質問は以下の通りです：

- アプリの構築  具体的なユースケースのために、AIを搭載したアプリケーションをどのように効率的に構築し、シームレスに統合するか？ 
- モニタリング デプロイされた後、アプリケーションの機能性と[責任あるAIの6原則](https://www.microsoft.com/ai/responsible-ai?WT.mc_id=academic-105485-koreyst)の遵守の両面で、最高レベルの品質で動作していることをどのように監視し、確認できるのか？

自動化と人間と機械のシームレスなインタラクションによって定義される時代へとさらに進むにつれて、生成AIがチャットアプリケーションの範囲、深さ、適応性をどのように変えるかを理解することが不可欠になります。このレッスンでは、これらの複雑なシステムをサポートするアーキテクチャの側面を調査し、ドメイン固有のタスクのためにそれらを微調整するための方法論を掘り下げ、責任あるAIの配備を確保するために適切なメトリクスと考慮事項を評価します。

## はじめに

このレッスンでは次のことを学びます：

- チャットアプリケーションの効率的な構築と統合のテクニック
- アプリケーションのカスタマイズと微調整の適用方法
- チャットアプリケーションを効果的に監視するための戦略と考慮事項。

## 学習目標

このレッスンが終了するころには、以下のことができるようになります：

- 既存のシステムにチャットアプリケーションを構築し統合するための考慮事項を説明する。
- 特定のユースケースのためのチャットアプリケーションのカスタマイズ
- AIを活用したチャットアプリケーションの品質を効果的に監視し、維持するための主要なメトリクスと考慮事項を特定する。
- チャットアプリケーションが責任を持ってAIを活用できるようにする。

## チャットアプリケーションへの生成AIの統合

生成AIによってチャットアプリケーションを高度化することは、単にスマート化することだけにとどまらず、アーキテクチャ、パフォーマンス、ユーザーインターフェースを最適化し、質の高いユーザーエクスペリエンスを提供することにつながります。これには、アーキテクチャの基礎、APIの統合、ユーザーインターフェースの考慮事項の調査が含まれます。このセクションでは、既存のシステムにプラグインする場合でも、独立したプラットフォームとして構築する場合でも、これらの複雑なランドスケープをナビゲートするための包括的なロードマップを提供することを目的としています。

このセクションが終了する頃には、チャットアプリケーションを効率的に構築し、組み込むために必要な専門知識が身に付いていることでしょう。

### チャットボットかチャットアプリケーションか？

チャットアプリケーションの構築に入る前に、「チャットボット」と「AI搭載チャットアプリケーション」を比較してみましょう。チャットボットの主な目的は、よくある質問への回答や荷物の追跡など、特定の会話タスクを自動化することです。通常、ルールベースのロジックや複雑なAIアルゴリズムによって管理されます。対照的に、AIを搭載したチャットアプリケーションは、人間のユーザー間のテキスト、音声、ビデオチャットなど、さまざまな形態のデジタルコミュニケーションを促進するために設計された、はるかに広範な環境です。その特徴は、生成AIモデルを統合することで、ニュアンスのある人間のような会話をシミュレートし、さまざまな入力や文脈の手がかりに基づいて応答を生成することです。生成AIを搭載したチャット・アプリケーションは、オープン・ドメインのディスカッションに参加し、進化する会話のコンテクストに適応し、創造的で複雑な対話を生み出すこともできる。

以下の表は、デジタル・コミュニケーションにおける独自の役割を理解するのに役立つ、主な違いと類似点の概要を示しています。

| チャットボット|生成AIを搭載したチャット・アプリケーション
| ------------------------------------- | -------------------------------------- |
| タスクフォーカス・ルールベース・コンテキスト認識型
| 多くの場合、より大規模なシステムに統合される|1つまたは複数のチャットボットをホストすることができる|。
| プログラムされた機能に限定される | 生成AIモデルを組み込んでいる |
| 専門的で構造化されたインタラクション|オープンドメインのディスカッションが可能

### SDKとAPIで事前に構築された機能を活用する

チャットアプリケーションを構築するとき、最初のステップは、すでにあるものを評価することです。チャットアプリケーションを構築するために SDK と API を使用することは、様々な理由で有利な戦略です。十分に文書化された SDK と API を統合することにより、スケーラビリティとメンテナンスの懸念に対処し、長期的な成功のために戦略的にアプリケーションを配置します。

- **開発プロセスを短縮し、オーバーヘッドを削減します： 開発プロセスを短縮し、オーバーヘッドを削減します**：自分で構築する高価なプロセスの代わりに、事前に構築された機能性に依存することで、ビジネスロジックなど、より重要と思われるアプリケーションの他の側面に集中することができます。
- **パフォーマンスの向上**： ゼロから機能を構築する場合、最終的には「どのようにスケーリングするのか？このアプリケーションは、突然のユーザー流入に対応できるのか？" という疑問が生じるでしょう。よく整備されたSDKやAPIには、こうした懸念に対するソリューションが組み込まれていることが多い。
- **メンテナンスが容易** ほとんどのAPIやSDKは、新しいバージョンがリリースされると、単にライブラリのアップデートが必要になるため、アップデートや改良の管理が容易になります。
- **最先端技術へのアクセス**： 大規模なデータセットで微調整・学習されたモデルを活用することで、アプリケーションに自然言語機能を提供できます。

SDKやAPIの機能にアクセスするには、通常、提供されるサービスの使用許可を得る必要があり、多くの場合、固有のキーまたは認証トークンを使用します。ここでは、OpenAI Python Libraryを使用して、これがどのようなものかを探ります。また、このレッスンは以下の[notebook for OpenAI](../../notebook-openai.ipynb?WT.mc_id=academic-105485-koreyst)または[notebook for Azure OpenAI Services](../../notebook-azure-openai.ipynb?WT.mc_id=academic-105485-koreys)で自分で試すこともできます。

```python
import os
import openai

openai.api_key = os.getenv("OPENAI_API_KEY")

chat_completion = openai.ChatCompletion.create(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "生成AIのチャットアプリケーションに関する指導レッスンのタイトルを2つ提案する。"}])
```

上の例ではGPT-3.5 Turboモデルを使ってプロンプトを完成させていますが、その前にAPIキーが設定されていることに注意してください。キーを設定しないと、次のようなエラーが表示されます。

```output
AuthenticationError： APIキーが指定されていません。コード内で 'openai.api_key = <API-KEY>' を使ってAPIキーを設定するか、環境変数OPENAI_API_KEY=<API-KEY>）を設定してください。APIキーがファイルに保存されている場合は、'openai.api_key_path = <PATH>'でopenaiモジュールを指定できます。APIキーはOpenAIのウェブインターフェイスで生成できます。詳しくは https://platform.openai.com/account/api-keys を参照してください。
```

## ユーザーエクスペリエンス（UX）

一般的なUXの原則は、チャットアプリケーションに適用されますが、ここでは、機械学習のコンポーネントが関与しているため、特に重要になる追加の考慮事項をいくつか示します。

- **曖昧さに対処するメカニズム**： 生成AIモデルは、時として曖昧な回答を生成します。ユーザーがこの問題に遭遇した場合、説明を求めることができる機能が役立ちます。
- **文脈の保持**： 高度な生成AIモデルは、会話内のコンテキストを記憶する能力を持っており、これはユーザーエクスペリエンスに必要な資産となり得る。ユーザーにコンテキストを制御・管理する能力を与えることは、ユーザーエクスペリエンスを向上させるが、機密性の高いユーザー情報を保持するリスクをもたらす。保持ポリシーを導入するなど、この情報が保存される期間を考慮することで、プライバシーに対するコンテキストの必要性のバランスを取ることができます。 
- **パーソナライゼーション** 学習し適応する能力を持つAIモデルは、ユーザーに個別化された体験を提供する。ユーザー・プロファイルのような機能を通じてユーザー体験を調整することは、ユーザーに理解されていると感じさせるだけでなく、具体的な答えを見つけるための追求を助け、より効率的で満足度の高いインタラクションを生み出す。

パーソナライゼーションの一例として、OpenAIのChatGPTの「カスタム指示」設定があります。これは、プロンプトの重要な文脈となる可能性のある、あなた自身に関する情報を提供することを可能にします。以下はカスタム指示の例です。

![ChatGPTのカスタム指示設定](../../images/custom-instructions.png?WT.mc_id=academic-105485-koreyst)

この "プロファイル "はChatGPTにリンクリストに関するレッスンプランの作成を促します。ChatGPTはユーザが経験に基づいてより深いレッスンプランを望んでいるかもしれないことを考慮していることに注意してください。

![リンクリストに関するレッスンプランのためのChatGPTのプロンプト](../../images/lesson-plan-prompt.png?WT.mc_id=academic-105485-koreyst)

### 大規模言語モデルのためのマイクロソフトのシステムメッセージフレームワーク

[マイクロソフトは、LLMから応答を生成する際に効果的なシステムメッセージを書くためのガイダンス](https://learn.microsoft.com/azure/ai-services/openai/concepts/system-message#define-the-models-output-format?WT.mc_id=academic-105485-koreyst)を4つの分野に分けて提供しています：

1. そのモデルが誰のためのものなのか、またその能力と限界を定義する。
2. モデルの出力形式の定義
3. モデルの意図された動作を示す具体例の提示。
4. 追加的な動作のガードレールの提供。

### アクセシビリティ

 ユーザーが視覚、聴覚、運動、認知のいずれに障害があろうとも、よく設計されたチャットアプリケーションは、すべての人が使用できるものでなければなりません。以下のリストでは、様々なユーザー障害のためにアクセシビリティを強化することを目的とした特定の機能を分解しています。

- **視覚障害のための機能**： 高コントラストのテーマとサイズ変更可能なテキスト、スクリーンリーダーとの互換性。
- **聴覚障害向け機能**： 音声読み上げとテキスト読み上げ機能、音声通知のためのビジュアルキュー。
- **運動障害のための機能**： キーボードナビゲーションサポート、音声コマンド。
- **認知障害向け機能**： 簡易言語オプション。

## ドメイン固有の言語モデルのカスタマイズと微調整

あなたの会社の専門用語を理解し、そのユーザーベースが一般的に持っている特定のクエリを予測するチャットアプリケーションを想像してみてください。特筆すべきいくつかのアプローチがあります：

- **DSLモデルの活用**。DSLとは、domain specific language（ドメイン固有言語）の略です。特定のドメインで訓練されたDSLモデルと呼ばれるものを活用することで、そのドメインの概念やシナリオを理解することができる。
- **ファインチューニングを適用する** ファインチューニングとは、特定のデータを使ってモデルをさらに訓練するプロセスです。

## カスタマイズ： DSLの使用

ドメイン固有の言語モデル（DSLモデル）を活用することで、専門的で文脈に関連したインタラクションを提供し、ユーザーエンゲージメントを高めることができます。DSLモデルとは、特定の分野、業界、または主題に関連するテキストを理解し、生成するために訓練または微調整されたモデルです。DSLモデルを使用するオプションは、ゼロからトレーニングするものから、SDKやAPIを通じて既存のものを使用するものまで様々である。また、既存の学習済みモデルを特定のドメインに適合させるファインチューニングという方法もある。

## カスタマイズ： ファインチューニングの適用

ファインチューニングは、事前に訓練されたモデルが専門的なドメインや特定のタスクで不十分な場合に検討されることが多い。

例えば、医療クエリは複雑で、多くのコンテキストを必要とする。医療専門家が患者を診断する場合、ライフスタイルや既往症など様々な要因に基づいており、診断を検証するために最近の医学雑誌に頼ることもある。このようなニュアンスの異なるシナリオでは、汎用のAIチャット・アプリケーションは信頼できる情報源とはなり得ない。

### シナリオ：医療アプリケーション

治療ガイドライン、薬物相互作用、または最近の研究結果への迅速な参照を提供することによって、開業医を支援するために設計されたチャットアプリケーションを考えてみましょう。

汎用のモデルは、基本的な医学的な質問に答えたり、一般的なアドバイスを提供したりするのには適切かもしれませんが、次のようなことには苦労するかもしれません：

- **非常に特殊または複雑な症例**。例えば、神経科医がアプリケーションに、"小児患者の薬剤耐性てんかんを管理するための現在のベストプラクティスは何ですか？"と質問するかもしれません。
- 最近の進歩に欠けている。汎用モデルでは、神経学や薬理学の最新の進歩を取り入れた最新の回答を提供するのに苦労する可能性があります。

このような場合、専門的な医療データセットでモデルを微調整することで、このような複雑な医学的問い合わせをより正確かつ確実に処理する能力を大幅に向上させることができる。そのためには、対処すべき領域特有の課題や疑問を表す、大規模で関連性の高いデータセットにアクセスする必要がある。

## 高品質なAIチャット体験のための考察

このセクションでは、実用的なメトリクスの取得と、AI技術を責任を持って活用するフレームワークの遵守を含む、「高品質」チャットアプリケーションの基準を概説します。

### 主要メトリクス

アプリケーションの高品質なパフォーマンスを維持するためには、主要な測定基準と考慮事項を追跡することが不可欠です。これらのメジャーはアプリケーションの機能性を保証するだけでなく、AIモデルの品質やユーザーエクスペリエンスも評価します。以下は、考慮すべき基本的なメトリクス、AIメトリクス、ユーザー・エクスペリエンス・メトリクスを網羅したリストです。

| メトリック | 定義 | チャット開発者のための考慮事項 |
| ----------------------------- | ---------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------- |
|**Uptime** | アプリケーションが稼働し、ユーザがアクセスできる時間をメジャーします。| どのようにダウンタイムを最小化しますか？  |
| **Response Time**  | ユーザーのクエリに対してアプリケーションが返答するのにかかる時間。| どのようにクエリ処理を最適化すれば、レスポンスタイムを改善できますか？ | 
| **Precision** | 陽性予測の総数に対する真の陽性予測の比率| モデルの精度をどのように検証するのか？    |
| **リコール（感度）**| 実際の陽性数に対する真の陽性予測の比率 |どのようにメジャーを測定し、リコールを改善しますか？                                 |
| **F1スコア**|精度と想起の調和平均で、両者のトレードオフのバランスをとる。                                  | 目標F1スコアは？どのように精度と想起のバランスをとるのか？ |
|**Perplexity** | モデルによって予測された確率分布が実際のデータ分布とどの程度一致しているかをメジャーで表します。| どのように当惑度を最小化するか？                                        |
| **ユーザー満足度**|アプリケーションに対するユーザーの認知度をメジャーで測ります。多くの場合、調査によって把握される。 | どのくらいの頻度でユーザのフィードバックを収集しますか？それに基づいてどのように適応させますか？|
|**エラー率** | モデルが理解や出力において間違いを犯す割合。| エラー率を減らすためにどのような戦略をとっていますか？              |
| **再トレーニングのサイクル**|新しいデータや洞察を取り入れるためにモデルを更新する頻度。                                   | モデルの再トレーニングの頻度は？再トレーニングサイクルのトリガーは何ですか？  |
| **異常検知**|予期された行動と一致しない異常なパターンを識別するためのツールとテクニック。                       | 異常にはどのように対応するのか？                                       |

### チャットアプリケーションにおける責任あるAIの実践

マイクロソフトの責任あるAIへのアプローチでは、AIの開発と利用の指針となるべき6つの原則を特定しています。以下に、原則とその定義、チャット開発者が考慮すべきこと、そしてなぜ真剣に取り組むべきかを示します。

| 原則|マイクロソフトの定義|チャット開発者が考慮すべきこと|なぜ重要なのか？|
| ---------------------- | ----------------------------------------------------- | ---------------------------------------------------------------------- | -------------------------------------------------------------------------------------- |
| 公平性|AIシステムは全ての人を公平に扱うべきです。           | チャット・アプリケーションがユーザー・データに基づいて差別しないようにすること。 | ユーザー間の信頼と包括性を構築する。               |
| 信頼性と安全性|AIシステムは確実かつ安全に動作すること。       | テストとフェイルセーフを実施し、エラーとリスクを最小限に抑える。        | ユーザーの満足を確保し、潜在的な危害を防ぐ。                                |
| プライバシーとセキュリティ|AIシステムは安全であり、プライバシーを尊重すべきである。     | 強力な暗号化とデータ保護メジャーを導入する。             | ユーザーの機密データを保護し、個人情報保護法を遵守する。                        |
| 包括性|AIシステムはすべての人に力を与え、人々を巻き込むべきである。| 多様な人々がアクセスでき、使いやすいUI/UXを設計する。| より幅広い人々がアプリケーションを効果的に使用できるようにする。                  |
| 透明性|AIシステムは理解可能であるべきだ。                 | AIの応答について明確な文書と理由を提供する。           | 判断がどのように下されるかを理解できれば、ユーザーはシステムをより信頼しやすくなる。|
| 説明責任|人々はAIシステムに対して説明責任を負うべきである。         | AIの決定を監査し、改善するための明確なプロセスを確立する。    | 継続的な改善と、ミスがあった場合の是正メジャーを可能にする。          |

## 課題
 
[課題](../../notebook-azure-openai.ipynb?WT.mc_id=academic-105485-koreyst)を参照してください。最初のチャットプロンプトの実行から、テキストの分類や要約など、一連の演習が行われます。

## 素晴らしい仕事！旅を続ける

このレッスンを終えたら、[生成AI学習コレクション](https://aka.ms/genai-collection?WT.mc_id=academic-105485-koreyst)をチェックして、生成AI知識のレベルアップを続けましょう！

レッスン8では、[検索アプリケーションの構築](../../../08-building-search-applications/translations/ja/README.md)を始める方法をご覧ください！
